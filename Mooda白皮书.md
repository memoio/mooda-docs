# Mooda白皮书

## 介绍

        区块链技术由于其安全、去中心化、透明的特性，持续吸引着金融和科技领域的目光，比特币作为其中的翘楚，最近也取得了重要的进步。随着见证隔离SegWit和Taproot升级，比特币的存储空间得到扩展，从而出现了序数协议和铭文等应用，这些应用方便用户将数据存储于比特币中。但是这些应用的出现只是稍微缓解了比特币生态对于存储需求的压力，因此生态提出了扩容方案——使用链下的数据可用层作为比特币扩容的解决方案。

        Mooda （Memo Bitcoin Ordinals Data Availability）是一个基于比特币的持续可验证的数据可用层，以在不牺牲安全性的情况下提高比特币的存储效率，降低存储成本，使用Mefs（Memolabs的分散式存储系统）提供存储服务，使用比特币区块存储验证信息，通过线下的索引器完成整个系统的验证和状态变更。Mooda的目标是为比特币生态用户提供一个低门槛、低成本、高效率、高安全的数据可用层。

## 铭文系统

### 铭文

        因为比特币空间大小的限制，导致比特币上的数字收藏品生态一直不温不火，直到比特币经过见证隔离SegWit和Tarpoot升级后，用户已经可以在每笔交易中写入4MB大小的内容，此时比特币的技术和空间对于数字藏品应用都已经足够，因此基于比特币的数字资产铭文应运而生。

        铭文是一段采用序数协议（ordinals）铭刻（inscribe）在聪（比特币的最小计账单位）上的数据。在比特币区块链的背景下，铭文的出现使得用户可以将4MB以下任何形式的内容铭刻到指定聪上，由比特币区块进行持久化存储。铭文的出现为比特币生态带来了新的功能和应用场景，尤其是在数据存储和非同质化代币（NFT）等领域。

        序数协议是一种对聪进行编号的方案，能够对单个聪进行跟踪和转移。编号的方案取决于开采聪的顺序，转移方案取决于交易输入和输出的顺序。序数协议可以将任何形式的内容作为稳定的标识符附加到聪上。

        由于Taproot脚本只能从现有的Taproot输出中使用，所以铭文通过提交和揭示两个阶段来实现铭文内容的展示，这两个阶段的过程就被称作为铭刻。

### 索引器

        尽管铭文技术为比特币生态带来了创新的发展机遇，但是比特币的脚本语言仍然存在局限性：无法直接处理复杂的逻辑和程序。为了克服这一图灵不完备性的挑战，生态用户引入了比特币索引器的概念。索引器作为一种补充解决方案，使得比特币能够间接处理更复杂的逻辑，从而扩展了其功能并增强了其在现代区块链应用中的适用性。通过这种方式，比特币索引器为比特币网络解锁了新的潜力，推动了其在金融科技和其他领域的进一步发展。

        索引器通过检索比特币的区块和交易数据，获取铭刻于区块中的数据，结合线下的存储层构建出图灵完备的系统。

        索引器包含以下几个功能：

1. 检索链上数据（找出铭刻于聪上的数据）

2. 筛选链上数据，确定状态，确定数据归属（谁上传的），确定数据权限（谁可以下载）

### BRC-721

        BRC-721是一个基于比特币实现非同质化代币（NFT）的协议 ，通过设计特定格式规范的铭文，从而实现代币的部署、铸造、转移、更新等操作，为在比特币区块链上实现非同质化代币提供了一种解决方案。

        BRC-721通过第三方存储保证数据的可用性，主要服务于数字资产等轻量级的存储应用，不适用于用户需要进行大量数据存储的应用。此外，即使使用ipfs作为存储方案也会面临用户数据无法保密的问题，这种方案不能满足用户存储隐私数据的需求。

## 当前问题

        将数据直接存储到比特币区块链上，虽然获得了不可篡改和持久化的特性，但是也存在一些显著的缺陷和挑战：

1. 链上存储需要支付交易费用，每次数据的读写都需要作为交易被添加到区块链上，对于大量数据，这些费用可能会变得非常昂贵。某匿名钱包花费1.5个比特币（价值约66000美元）铭刻了近9MB的数据。

2. 区块链网络通常有着严格的数据限制，每个区块的存储数量有限，尽管比特币经过了Taproot升级，将单笔交易中可写入的数据从80字节的限制提升到了大约4MB，但是仍然不能满足网络中日益增长的存储需求。

3. 随着区块链网络的增长，链上数据的增加可能会导致网络拥堵，降低交易处理速度，随着铭文的火爆，比特币链网络中常常出现一个铭文将整个区块占满的情况，影响其他交易数据的打包。

4. 区块链网络的数据通常是公开的，意味着任何人都能查看存储到链上的信息，这可能会引发隐私泄露的风险，尤其是需要保密的存储场景。

        为了解决比特币中的上述问题，生态参与者提出了数据可用层的概念。

## 数据可用层

        数据可用层（Data Availability Layer）是用来解决区块链网络中数据存储和可访问性问题的新兴方案，它可以确保所有的网络参与者都能快速且容易的访问到用户数据和其他信息。

        数据可用层具有以下特点：

1. 通过将数据存储任务从链上分离出来，有助于减轻链上负担，提高整个网络的处理速度和效率。

2. 可以提供数据验证机制，确保数据的准确性和完整性，同时不会暴露数据本身，提高了存储的隐私性。

3. 可以通过在存储层添加权限控制，保障用户的数据安全以及隐私性需求。

4. 数据存储通常采用分布式存储，有助于保持整个网络的去中心化特性。

5. 兼容性强可以支持多个区块链网络。

## 解决方案

        针对链上数据存储的问题，下文将分开讲述当前的解决方案以及Mooda解决方案。

### 当前DA解决方案

        这里将分开介绍以太坊生态的数据可用性解决方案与比特币生态的数据可用性解决方案。

#### ETH的解决方案

        ETH主要有两种解决方案。第一种是优化Layer2的存储开销方案，比如以太坊的Danksharding提案 ，目前是采用了EIP-4844，实现了blob交易方式，降低Layer2在依赖以太坊作为数据可用性层的存储开销；第二种是模块化区块链方案，将执行层、共识层、数据可用性层分开设计，比如Celestia项目，旨在通过提供可插拔的共识网络来简化区块链部署。

#### BTC的解决方案

        BTC目前出现了Nubit和$B^2$等数据可用性解决方案。

        Nubit采用模块化索引器和数据可用层结合的方案。委员会（committee）索引器根据链上数据计算检查点，之后将检查点存放于数据可用层中；普通索引器返回查询结果和证明；轻量索引器从数据可用层中获取检查点并验证证明的正确性。Nubit方案将整个状态的完整性检查简化为少量检查点有效性的检查。

        $B^2$的数据可用层由三部分组成：去中心化存储、比特币网络和$B^2$节点。去中心化存储从Rollup层获取数据并存储，定期根据存储汇总的时间和空间生成零知识证明，将存储证明发送给$B^2$节点，$B^2$节点充当链下验证者，验证存储证明的正确性；比特币网络作为$B^2$网络的最终结算层，$B^2$网络的汇总数据存储在比特币网络中，根据比特币网络上的$B^2$铭文确认$B^2$的交易数据。

#### 现有方案问题

        ETH的方案目前不能直接套用于比特币领域。

        Nubit的方案需要确保至少一个委员会索引器是忠诚的，才能确保数据的可用性。

        $B^2$的方案需要运行$B^2$节点。

### Mooda解决方案

        Mooda将数据存储于链下的分散式存储中，将数据的存储凭证和验证信息放在比特币区块链上，验证节点可以随时从链上获取验证信息和存储凭证，来验证存储中的数据是否存在。 

        Mooda由三个部分组成：存储验证层、比特币区块和索引器。Mooda将用户数据存储于线下的去中心化存储，将存储的证明和验证信息存放于比特币链上，使用索引器获取并验证链上的验证信息。

        Mooda通过周期性向区块链提交证明，实现验证的可持续性，为了防止存储证明层使用同一证明，每个周期会选定一个随机数参与证明的生成。

![](mooda.png)

#### 存储验证层

        存储验证层包含数据存储、凭证生成和周期证明生成。用户上传数据后，存储验证层返回数据存储凭证，用户将凭证上链后，存储验证层会在每个周期都上传证明到链上，根据索引器提供的数据权限，给有权限的用户提供下载服务。

* 存储：通过Mefs等提供可靠安全的去中心化存储，为整个系统提供存储服务，提供上传下载接口，存储数据。

* 凭证生成：根据用户上传的数据，生成数据的存储凭证，用以向用户证明存储的对象与存储时间。

* 数据周期证明：数据周期证明包含周期和证明两种信息，周期确定验证的范围，证明用来保证数据在这个周期存在于存储中，为了确保每个周期的证明不可预测，引入一个随机数参与证明的生成。

#### 索引器

        索引器（Indexer）监控比特币网络上的区块和交易，获取交易中存储的验证信息，并根据验证信息验证用户数据的正确性，用以确保数据的可用性。

        索引器包含验证者和市场两个部分：

* 验证者：验证者负责对索引器获取的数据进行验证，从而确认用户的数据被存储层有效保管。

* 市场：用户可以将存储的数据权限进行交易，拥有读权限的用户可以从存储验证层中获取对应的数据。

#### 比特币上的铭文

        Mooda通过铭文存储数据的凭证、证明、周期等信息，从而让这些关键而少量的信息在比特币上被持久化存储，将这些信息公开透明地展示给所有的验证者，以供验证者验证数据的可用性。

        Mooda 的铭文分为三类：

* 数据唯一凭证铭文：数据唯一凭证是存储验证层根据数据内容生成的唯一凭证，用以向用户证明数据已经被存储。铭文包含存储的签名以及数据的hash值。

* 周期铭文：周期铭文包含时间信息，是整个持续验证系统的尺度，用于让验证者确认验证的范围，同时提供一个随时间变化的随机数，使得存储证明的生成不能被预测。

* 数据证明铭文：数据证明铭文包含存储验证层根据数据和周期铭文提供的随机数生成的证明，由存储验证层周期性的提交到比特币网络中。

        Mooda使用周期铭文的铭文id作为随机种子，随机种子是一个参与验证的随机值，用于防止预测攻击。

## 技术亮点

        Mooda通过引入周期铭文的概念，确定了可用性证明上传的周期，同时也解决了零知识证明中获取随机种子的问题。

        通过将凭证信息和证明信息存放于比特币网络中，从而进行持久化存储，同时将用户数据存储于链下去中心化的存储系统中，从而实现了整个数据可用层的低成本、高可扩展性以及去中心化特性。

        依托于现有的比特币铭文，降低了用户的使用门槛，用户可以方便快捷的使用Mooda解决比特币中的数据可用性问题。
